# AGENTS

## 项目愿景

本仓库的目标是用 Rust 重写原版基于检索的语音转换 WebUI。新的 Rust 工作区（`rvc-rs`）包含：

- `rvc-lib`：核心功能的 Rust 库，基于 `tch` 实现
- `ui`：使用 Vue 3 和 Vite 构建的前端，打包进 Tauri 应用中（位于 `ui/src-tauri`）

本项目旨在实现与 `gui_v1.py` 功能等效，同时借助 Rust 与 Tauri 提供更好的性能与可维护性。

## 架构原则

### 职责分离

- **`rvc-lib`**：包含**所有核心功能**，包括：
  - 模型加载与管理
  - 音频处理流程
  - 参数的加载与保存
  - 配置管理
  - 实时语音转换逻辑
  - 设备管理
  - 所有业务逻辑与数据处理

- **Tauri (`ui/src-tauri`)**：**仅作为前端与后端的桥梁**：
  - 接收来自 Vue 前端的请求
  - 调用 `rvc-lib` 中对应的方法
  - 将结果返回前端
  - 向前端推送事件或进度更新
  - **不应包含任何实际功能或业务逻辑**
  - **不得重复实现 `rvc-lib` 中已有的逻辑**

### 核心规则

1. **禁止逻辑重复**：若功能已存在于 `rvc-lib`，Tauri 不得重新实现
2. **Tauri 仅作中介**：Tauri 的函数应为薄包装，仅用于调用 `rvc-lib`
3. **状态管理归属**：应用状态必须由 `rvc-lib` 管理，不能放在 Tauri 中
4. **参数处理归属**：所有参数的校验、加载、保存必须在 `rvc-lib` 中完成

## 开发指南

- 修改 Rust 代码后，请运行：

  ```bash
  cargo check -p rvc-lib --manifest-path rvc-rs/Cargo.toml
  ```

* 修改 Tauri 代码后，请运行：

  ```bash
  cargo check --manifest-path rvc-rs/ui/src-tauri/Cargo.toml
  ```

* 修改 Vue 前端代码后，请在 `rvc-rs/ui` 中运行：

  ```bash
  npm run build
  ```

  若有依赖变动，请先运行：

  ```bash
  npm install
  ```

* 是否运行 Tauri 应用程序可选，但它依赖于系统组件如 `glib`

* 添加新功能时，**请先在 `rvc-lib` 中实现**，然后创建 Tauri 的简薄封装接口

* **避免** `rvc-lib` 中的函数名与 Tauri 命令函数发生命名冲突
好的，以下是在原说明基础上**增加的要求**，以完整中文 Markdown 格式呈现：

## 开发附加要求

### 变更记录（CHANGELOG）

- 每次进行功能添加、修改或重构后，**必须在 `CHANGELOG.md` 文件中记录改动内容**，包括但不限于：
  - 添加的新功能或命令
  - 修改的参数结构或默认值
  - 修复的 Bug
  - 性能优化点
- 版本号每次增加 0.1.0，记录提交时间而非日期

### 功能对照检查

* 每次提交代码后，必须手动或脚本方式**对比 Rust 实现与原始 Python 实现（`gui_v1.py`）之间的功能差异**

  * 对照内容包括参数支持情况、模型行为、输出格式、错误处理逻辑等

* 对比完成后，请回答以下两个问题以指导后续开发：

  1. **当前 Rust 实现是否已覆盖 Python 的全部功能？**
  2. **若有缺失，请明确指出下一步该补充哪些功能？**
